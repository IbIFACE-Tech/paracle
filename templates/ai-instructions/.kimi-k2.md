# Kimi K2 Guide for Paracle .parac Configuration

## 概述 Overview

Paracle 是一个多智能体AI框架。项目配置存储在 `.parac/` 目录中。

Paracle is a multi-agent AI framework. Project configuration is stored in the `.parac/` directory.

## 目录结构 Directory Structure

```
.parac/
├── project.yaml          # 主配置文件 Main configuration
├── agents/              # 智能体定义 Agent definitions
│   ├── manifest.yaml
│   └── specs/*.yaml
├── workflows/           # 工作流 Workflows
│   ├── catalog.yaml
│   └── templates/*.yaml
├── tools/               # 工具 Tools
│   └── registry.yaml
├── policies/            # 策略 Policies
│   ├── policy-pack.yaml
│   └── security.yaml
└── memory/              # 记忆 Memory
    └── knowledge/*.md
```

## 核心原则 Core Principles

### 1. Schema 版本 Schema Version
所有 YAML 文件必须包含 / All YAML files must include:
```yaml
schema_version: "1.0"
```

### 2. 命名规范 Naming Conventions
- **文件 Files**: lowercase-with-hyphens.yaml
- **智能体 Agents**: descriptive-role-name
- **变量 Variables**: snake_case

### 3. 安全优先 Security First
- 工具默认禁用 / Tools disabled by default
- 启用内容过滤 / Content filtering enabled
- 使用环境变量 / Use environment variables
- 不要硬编码密钥 / No hardcoded secrets

## 项目配置 Project Configuration

```yaml
# .parac/project.yaml
name: my-project
version: 0.1.0
description: "项目描述 Project description"
schema_version: "1.0"

defaults:
  python_version: "3.10"
  model_provider: openai
  default_model: gpt-4
  temperature: 0.7

features:
  enable_mcp: true
  enable_api: true
  enable_events: true
```

## 智能体配置 Agent Configuration

### 清单 Manifest
```yaml
# agents/manifest.yaml
schema_version: "1.0"
agents:
  - name: assistant
    description: "AI助手 AI assistant"
    spec_file: specs/assistant.yaml
    enabled: true
    version: 1.0.0
    tags: [helper, general]
```

### 规格 Specification
```yaml
# agents/specs/assistant.yaml
name: assistant
description: "有用的AI助手 Helpful AI assistant"
version: 1.0.0

provider: openai
model: gpt-4
temperature: 0.7
max_tokens: 2000

system_prompt: |
  你是一个有用的AI助手。
  You are a helpful AI assistant.

  提供清晰、准确、简洁的答案。
  Provide clear, accurate, and concise answers.

# 分配技能 Assign skills
skills:
  - question-answering
  - text-summarization
  - code-generation

capabilities:
  - question_answering
  - task_assistance

memory:
  enabled: true
  type: conversation
```

### 智能体技能 Agent Skills

Paracle 支持两种技能格式 / Paracle supports two skill formats:

**1. YAML 格式（轻量级）/ YAML Format (Lightweight)**

适用于简单声明 / Best for simple declarations:

```yaml
# .parac/agents/skills/custom/my-skill.yaml
name: my-skill
category: creation          # communication|analysis|creation|transformation|integration|memory
level: intermediate         # basic|intermediate|advanced|expert
description: 技能描述 / Skill description
tools: [tool1, tool2]
capabilities: [cap1, cap2]
version: "1.0.0"
```

**2. SKILL.md 格式（详细文档）/ SKILL.md Format (Detailed Documentation)**

适用于详细说明和代码示例 / Best for detailed instructions with code:

```markdown
# .parac/agents/skills/custom/my-skill/SKILL.md
---
name: my-skill
description: 技能详细说明 / Detailed skill description
metadata:
  category: creation
  level: intermediate
  display_name: "My Skill"
allowed-tools: Read Write Bash
---
# My Skill

## 何时使用 When to use
[使用场景 Use cases]

## 如何使用 How to use
[代码示例 Code examples]
```

**内置技能 Built-in Skills:**
- `question-answering` (通信 Communication, 中级 Intermediate)
- `code-generation` (创造 Creation, 高级 Advanced)
- `data-analysis` (分析 Analysis, 高级 Advanced)
- `text-summarization` (转换 Transformation, 中级 Intermediate)
- `api-integration` (集成 Integration, 高级 Advanced)

**技能类别 Skill Categories:**
- communication (通信), analysis (分析), creation (创造)
- transformation (转换), integration (集成), memory (记忆)

**技能等级 Skill Levels:**
- basic (基础 0-25%), intermediate (中级 25-50%)
- advanced (高级 50-75%), expert (专家 75-100%)

## 工作流配置 Workflow Configuration

```yaml
# workflows/catalog.yaml
schema_version: "1.0"
workflows:
  - name: greeting-workflow
    description: "问候工作流 Greeting workflow"
    template: templates/greeting.yaml
    enabled: true

# workflows/templates/greeting.yaml
name: greeting-workflow
version: 1.0.0

inputs:
  - name: user_name
    type: string
    required: true

steps:
  - name: greet
    agent: assistant
    prompt: "为{user_name}生成友好的问候 Generate friendly greeting for {user_name}"
    output: greeting

outputs:
  - name: result
    value: "{greeting}"
```

## 温度设置指南 Temperature Guide

```yaml
# 确定性任务 Deterministic tasks (代码 code, 数据 data)
temperature: 0.0-0.3

# 平衡任务 Balanced tasks (一般协助 general assistance)
temperature: 0.5-0.7

# 创造性任务 Creative tasks (内容生成 content generation)
temperature: 0.8-1.0
```

## 模型选择 Model Selection

```yaml
# 复杂推理 Complex reasoning
provider: openai
model: gpt-4

# 简单任务 Simple tasks
provider: openai
model: gpt-3.5-turbo

# 长上下文 Long context
provider: anthropic
model: claude-3-opus-20240229

# 本地部署 Local deployment
provider: local
model: llama2
```

## 安全配置 Security Configuration

```yaml
# policies/security.yaml
schema_version: "1.0"

content_filtering:
  enabled: true              # 启用过滤 Enable filtering
  filter_pii: true           # 过滤个人信息 Filter PII
  filter_harmful: true       # 过滤有害内容 Filter harmful content

rate_limiting:
  enabled: true
  requests_per_minute: 60

# tools/registry.yaml
builtin_tools:
  - name: web_search
    enabled: false           # 默认禁用 Disabled by default

  - name: file_system
    enabled: false
    permissions: [read]      # 最小权限 Minimal permissions
    allowed_paths: [/tmp]    # 限制路径 Restricted paths
```

## 常见任务 Common Tasks

### 初始化项目 Initialize Project

```bash
# 复制模板 Copy template
cp -r templates/.parac-template .parac

# 编辑配置 Edit configuration
nano .parac/project.yaml

# 设置环境 Set up environment
cp .parac/.env.example .env
nano .env  # 添加 API 密钥 Add API keys
```

### 创建智能体 Create Agent

```bash
# 1. 创建规格 Create specification
cat > .parac/agents/specs/my-agent.yaml << EOF
name: my-agent
provider: openai
model: gpt-4
temperature: 0.7
system_prompt: |
  你的角色和指令...
  Your role and instructions...
EOF

# 2. 注册 Register
# 编辑 .parac/agents/manifest.yaml
agents:
  - name: my-agent
    spec_file: specs/my-agent.yaml
    enabled: true
```

### 创建工作流 Create Workflow

```bash
# 1. 创建模板 Create template
cat > .parac/workflows/templates/my-workflow.yaml << EOF
name: my-workflow
version: 1.0.0
steps:
  - name: step1
    agent: my-agent
    prompt: "任务描述 Task description"
    output: result
EOF

# 2. 注册 Register
# 编辑 .parac/workflows/catalog.yaml
workflows:
  - name: my-workflow
    template: templates/my-workflow.yaml
    enabled: true
```

## 验证 Validation

### YAML 语法 YAML Syntax
```python
import yaml

# 验证语法 Validate syntax
with open('.parac/project.yaml') as f:
    config = yaml.safe_load(f)

# 检查schema版本 Check schema version
assert config.get('schema_version') == '1.0'

# 检查必需字段 Check required fields
assert 'name' in config
assert 'version' in config
```

### 安全检查 Security Check
```bash
# 检查密钥 Check for secrets
grep -rn "sk-\|api.*key.*:" .parac/ --exclude-dir=logs

# 验证工具配置 Verify tool config
grep -A5 "builtin_tools:" .parac/tools/registry.yaml
```

## 环境变量 Environment Variables

```bash
# 必需 Required
export OPENAI_API_KEY="sk-..."
export ANTHROPIC_API_KEY="sk-ant-..."

# 可选 Optional
export PARACLE_ENV="development"
export PARACLE_LOG_LEVEL="INFO"
export PARACLE_API_PORT="8000"
```

## 常见错误 Common Errors

### 1. 缺少 schema_version / Missing schema_version
```yaml
# ❌ 错误 Error
name: my-project

# ✅ 正确 Correct
name: my-project
schema_version: "1.0"
```

### 2. 无效的智能体引用 / Invalid Agent Reference
```yaml
# ❌ 错误 Error - 智能体不存在 agent doesn't exist
steps:
  - agent: non-existent

# ✅ 正确 Correct - 使用现有智能体 use existing agent
steps:
  - agent: assistant
```

### 3. 硬编码密钥 / Hardcoded Secrets
```yaml
# ❌ 错误 Error
openai:
  api_key: "sk-..."

# ✅ 正确 Correct
openai:
  # api_key: 通过环境变量设置 set via OPENAI_API_KEY
```

## 最佳实践 Best Practices

### 1. 清晰的系统提示 Clear System Prompts
```yaml
system_prompt: |
  # 定义角色 Define role
  你是一个专业的代码审查员。
  You are a professional code reviewer.

  # 列出职责 List responsibilities
  你的职责：
  Your responsibilities:
  - 检查代码质量 Check code quality
  - 发现潜在问题 Find potential issues
  - 提供改进建议 Provide improvement suggestions

  # 设置指南 Set guidelines
  指南 Guidelines:
  - 保持客观 Be objective
  - 提供具体示例 Provide specific examples
  - 解释原因 Explain reasoning
```

### 2. 渐进式启用 Progressive Enablement
```yaml
# 开发 Development
features:
  enable_api: true
  enable_tracing: false

# 生产 Production
features:
  enable_api: true
  enable_tracing: true
  enable_observability: true
```

### 3. 多语言支持 Multilingual Support
```yaml
# 双语智能体 Bilingual agent
system_prompt: |
  You are a bilingual assistant.
  你是一个双语助手。

  You can communicate in both English and Chinese.
  你可以用中文和英文交流。
```

## 快速参考 Quick Reference

```yaml
# 智能体模板 Agent Template
name: agent-name
provider: openai
model: gpt-4
temperature: 0.7
system_prompt: |
  角色和指令 Role and instructions

# 工作流模板 Workflow Template
name: workflow-name
steps:
  - name: step1
    agent: agent-name
    prompt: "任务 Task"
    output: result

# 安全模板 Security Template
content_filtering:
  enabled: true
  filter_pii: true
rate_limiting:
  enabled: true
```

## 验证命令 Validation Commands

```bash
# YAML 语法 YAML syntax
python -c "import yaml; yaml.safe_load(open('.parac/project.yaml'))"

# 安全检查 Security check
grep -r "api.*key.*:" .parac/ --exclude-dir=logs

# 智能体存在性 Agent existence
grep "name: my-agent" .parac/agents/manifest.yaml
```

---

**记住 Remember**:
- 验证后再提交 / Validate before committing
- 安全第一 / Security first
- 使用环境变量 / Use environment variables
- 文档化变更 / Document changes
- 增量测试 / Test incrementally

**提示 Tips**:
- 从简单开始 / Start simple
- 按需添加功能 / Add features as needed
- 保持配置清晰 / Keep config clean
- 定期审查安全性 / Review security regularly
