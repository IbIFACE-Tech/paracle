# DeepSeek Coder Guide for Paracle .parac Configuration

## Overview

Paracle is a multi-agent AI framework. Project configuration lives in `.parac/` directory.

## Directory Layout

```
.parac/
├── project.yaml              # Core configuration (required)
├── agents/
│   ├── manifest.yaml        # Agent registry
│   └── specs/*.yaml         # Agent specifications
├── workflows/
│   ├── catalog.yaml         # Workflow registry
│   └── templates/*.yaml     # Workflow definitions
├── tools/registry.yaml      # Tool management
├── policies/
│   ├── policy-pack.yaml     # Active policies
│   └── security.yaml        # Security rules
├── memory/
│   ├── index.yaml           # Memory management
│   └── knowledge/*.md       # Knowledge base
└── adapters/
    └── orchestrators.yaml   # External integrations
```

## Core Configuration

### project.yaml

```yaml
# Required fields
name: project-name              # Unique identifier
version: 0.1.0                 # Semantic versioning
description: "Project purpose"
schema_version: "1.0"          # Must be present

# Provider defaults
defaults:
  python_version: "3.10"
  model_provider: openai        # openai | anthropic | google | local
  default_model: gpt-4
  temperature: 0.7              # 0.0 (deterministic) to 1.0 (creative)

# Feature flags
features:
  enable_mcp: true              # Model Context Protocol
  enable_api: true              # REST API server
  enable_events: true           # Event bus
  enable_tracing: false         # OpenTelemetry tracing
  enable_observability: false   # Metrics/monitoring

# Logging
logging:
  level: INFO                   # DEBUG | INFO | WARNING | ERROR | CRITICAL
  format: json                  # json | text
  rotation: daily               # daily | weekly | size-based
  retention_days: 30
```

## Agent Configuration

### Agent Manifest

```yaml
# agents/manifest.yaml
schema_version: "1.0"

agents:
  - name: code-assistant
    description: "Helps with coding tasks"
    spec_file: specs/code-assistant.yaml
    enabled: true
    version: 1.0.0
    tags:
      - coding
      - assistant

settings:
  auto_register: false
  require_validation: true
  enable_inheritance: true
```

### Agent Specification

```yaml
# agents/specs/code-assistant.yaml
name: code-assistant
description: "Expert software engineer"
version: 1.0.0

provider: openai
model: gpt-4
temperature: 0.3

system_prompt: |\n  Expert software engineer. Writes clean, maintainable code.

# Assign capabilities via skills
skills:
  - question-answering
  - code-generation
  - data-analysis

tools:
  - file_system
  - code_executor

memory:
  enabled: true
  strategy: sliding_window
```

### Agent Skills System

Paracle supports **two skill formats**:

**1. YAML (Lightweight)** - Quick capability declarations

```yaml
# .parac/agents/skills/custom/api-client.yaml
name: api-client
category: integration    # communication|analysis|creation|transformation|integration|memory
level: advanced          # basic|intermediate|advanced|expert
description: Build and interact with REST/GraphQL APIs
tools: [http_client]
capabilities: [rest_api, graphql]
tags: [api, integration]
version: "1.0.0"
```

**2. SKILL.md (Rich Documentation)** - Detailed instructions with code

```markdown
# .parac/agents/skills/custom/api-client/SKILL.md
---
name: api-client
description: Build and interact with REST/GraphQL APIs
metadata:
  category: integration
  level: advanced
allowed-tools: Read Write Bash(curl:*)
---
# API Client Skill
## When to use
- Building API integrations
## How to...
[Code examples and best practices]
```

**Built-in Skills:**
- `question-answering` (Communication, Intermediate)
- `code-generation` (Creation, Advanced)
- `data-analysis` (Analysis, Advanced)
- `text-summarization` (Transformation, Intermediate)
- `api-integration` (Integration, Advanced)

**Categories:** communication, analysis, creation, transformation, integration, memory
**Levels:** basic (0-25%), intermediate (25-50%), advanced (50-75%), expert (75-100%)
name: code-assistant
description: "AI coding assistant"
version: 1.0.0

# Model configuration
provider: openai
model: gpt-4
temperature: 0.3                # Lower for code = more deterministic
max_tokens: 4000

# System prompt
system_prompt: |
  You are an expert software engineer.

  Your responsibilities:
  - Write clean, efficient code
  - Follow best practices
  - Explain your reasoning
  - Consider edge cases

  Language-specific guidelines:
  - Python: PEP 8, type hints
  - JavaScript: ES6+, async/await
  - TypeScript: Strict mode, interfaces

# Capabilities
capabilities:
  - code_generation
  - code_review
  - debugging
  - refactoring

# Tool access (optional)
tools:
  - name: file_system
    enabled: true
    permissions: [read, write]
  - name: code_executor
    enabled: false

# Memory configuration
memory:
  enabled: true
  type: semantic               # conversation | semantic | hybrid
  max_history: 20

# Guardrails
guardrails:
  enable_content_filtering: true
  max_retries: 3
  timeout: 300
```

## Workflow Configuration

### Workflow Catalog

```yaml
# workflows/catalog.yaml
schema_version: "1.0"

workflows:
  - name: code-review
    description: "Automated code review workflow"
    template: templates/code-review.yaml
    enabled: true
    version: 1.0.0
    tags:
      - code-quality
      - review

settings:
  auto_register: false
  require_validation: true
  enable_parallel: true
  default_timeout: 600
```

### Workflow Definition

```yaml
# workflows/templates/code-review.yaml
name: code-review
description: "Multi-stage code review"
version: 1.0.0

# Input schema
inputs:
  - name: file_path
    type: string
    description: "Path to file to review"
    required: true

  - name: review_depth
    type: string
    description: "Review thoroughness"
    required: false
    default: standard
    enum: [quick, standard, thorough]

# Workflow steps
steps:
  # Step 1: Syntax check
  - name: syntax_check
    agent: code-assistant
    prompt: |
      Review syntax and basic structure of: {file_path}
      Return only issues found.
    output: syntax_issues

  # Step 2: Logic review
  - name: logic_review
    agent: code-assistant
    prompt: |
      Review logic and algorithms in: {file_path}
      Previous issues: {syntax_issues}
      Depth: {review_depth}
    output: logic_issues

  # Step 3: Security audit
  - name: security_audit
    agent: security-agent
    prompt: |
      Check security vulnerabilities in: {file_path}
      Focus on common OWASP issues.
    output: security_issues

  # Step 4: Compile report
  - name: compile_report
    agent: code-assistant
    prompt: |
      Create comprehensive review report:
      - Syntax: {syntax_issues}
      - Logic: {logic_issues}
      - Security: {security_issues}

      Format as markdown with severity levels.
    output: final_report

# Output schema
outputs:
  - name: review_report
    value: "{final_report}"
    description: "Complete code review report"

  - name: has_critical_issues
    value: "{security_issues}"
    description: "Security issues found"

# Execution settings
execution:
  timeout: 300
  max_retries: 2
  retry_delay: 1
  continue_on_error: false
```

## Tool Configuration

```yaml
# tools/registry.yaml
schema_version: "1.0"

# Built-in tools
builtin_tools:
  - name: web_search
    description: "Search the web"
    enabled: false               # Security: disabled by default
    provider: duckduckgo

  - name: file_system
    description: "File operations"
    enabled: false
    permissions:
      - read                     # read | write | delete
    allowed_paths:
      - /tmp
      - ./data
    blocked_paths:
      - /etc
      - ~/.ssh

  - name: code_executor
    description: "Execute code safely"
    enabled: false
    languages:
      - python
      - javascript
    timeout: 30
    max_memory: 512MB
    sandbox: true                # Always sandboxed

# Custom tools
custom_tools:
  - name: git_operations
    description: "Git commands"
    implementation: custom/git_tool.py
    enabled: false
    config:
      allowed_commands:
        - status
        - log
        - diff
      # No push, force, etc.

# Permissions
permissions:
  default_enabled: false
  require_approval: true
  enable_audit_log: true
```

## Security Configuration

```yaml
# policies/security.yaml
schema_version: "1.0"

# Content filtering
content_filtering:
  enabled: true
  filter_pii: true               # Personal info
  filter_harmful: true           # Harmful content
  filter_bias: false             # Experimental

  blocked_patterns:
    - "(?i)password\\s*[:=]"     # Password detection
    - "(?i)api[_-]?key\\s*[:=]"  # API key detection
    - "-----BEGIN.*PRIVATE KEY"  # Private key detection

# Rate limiting
rate_limiting:
  enabled: true
  requests_per_minute: 60
  requests_per_hour: 1000
  burst_size: 10

  # Per-agent limits
  agent_limits:
    code-assistant: 100          # Higher limit for main agent
    experimental-agent: 10       # Lower for experimental

# API security
api_security:
  require_authentication: false  # Set true for production
  allowed_origins:
    - http://localhost:3000
    - http://localhost:8000

  # Rate limiting
  api_rate_limit: 100

# Data protection
data_protection:
  encrypt_at_rest: false         # Enable for sensitive data
  encrypt_in_transit: true       # Always use TLS
  retention_days: 30
  anonymize_logs: true

  # PII handling
  pii_redaction:
    enabled: true
    patterns:
      - email
      - phone
      - ssn
      - credit_card

# Tool permissions
tool_permissions:
  default_deny: true

  # Agent-specific permissions
  agent_permissions:
    code-assistant:
      - file_system:read
      - web_search

    admin-agent:
      - file_system:read
      - file_system:write

  # Restricted operations
  restricted_operations:
    - file_system:delete
    - code_executor:shell
    - network:external

# Audit logging
audit:
  enabled: true
  log_all_requests: true
  log_tool_usage: true
  log_errors: true
  log_pii_access: true           # Log when PII is accessed
  retention_days: 90
```

## Best Practices

### Model Selection by Task

```yaml
# Code generation/review
provider: openai
model: gpt-4
temperature: 0.2-0.3

# Data analysis
provider: anthropic
model: claude-3-opus-20240229
temperature: 0.3-0.5

# Creative content
provider: openai
model: gpt-4
temperature: 0.8-1.0

# High-volume, simple tasks
provider: openai
model: gpt-3.5-turbo
temperature: 0.5-0.7
```

### Temperature Guidelines

```python
# Deterministic tasks
DETERMINISTIC = 0.0-0.3      # Code, calculations, parsing
ANALYTICAL = 0.3-0.5         # Analysis, review, summarization
BALANCED = 0.5-0.7           # General assistance, Q&A
CREATIVE = 0.7-0.9           # Content generation, brainstorming
HIGHLY_CREATIVE = 0.9-1.0    # Creative writing, poetry
```

### Naming Conventions

```yaml
# Files: lowercase-with-hyphens
✅ code-reviewer.yaml
✅ data-processor.yaml
❌ CodeReviewer.yaml
❌ data_processor.yaml

# Agents: descriptive, role-based
✅ python-code-assistant
✅ security-auditor
❌ agent1
❌ helper

# Variables: snake_case
✅ user_input
✅ processed_data
❌ userData
❌ ProcessedData
```

### Security Checklist

```yaml
# Before production deployment
□ Content filtering enabled
□ PII detection enabled
□ Rate limiting configured
□ Tools properly restricted
□ No hardcoded secrets
□ Audit logging enabled
□ HTTPS/TLS enforced
□ API authentication enabled
□ Tool permissions reviewed
□ Backup strategy defined
```

## Validation

```python
# Validate YAML syntax
import yaml

def validate_config(file_path):
    try:
        with open(file_path) as f:
            config = yaml.safe_load(f)

        # Check schema version
        assert 'schema_version' in config
        assert config['schema_version'] == '1.0'

        # Check required fields (project.yaml)
        if 'name' in config:
            assert 'version' in config
            assert 'description' in config

        return True
    except Exception as e:
        print(f"Validation error: {e}")
        return False

# Usage
validate_config('.parac/project.yaml')
validate_config('.parac/agents/manifest.yaml')
```

## Environment Variables

```bash
# Required - LLM providers
export OPENAI_API_KEY="sk-..."
export ANTHROPIC_API_KEY="sk-ant-..."
export GOOGLE_API_KEY="..."

# Optional - Paracle configuration
export PARACLE_ENV="development"        # development | staging | production
export PARACLE_LOG_LEVEL="INFO"
export PARACLE_API_HOST="0.0.0.0"
export PARACLE_API_PORT="8000"

# Optional - External services
export DATABASE_URL="postgresql://..."
export REDIS_URL="redis://..."
export OTEL_ENDPOINT="http://localhost:4317"
```

## Common Patterns

### Creating a Multi-Agent Workflow

```yaml
# Example: Document processing pipeline
name: document-pipeline
steps:
  - name: extract
    agent: text-extractor
    prompt: "Extract text from {document}"
    output: raw_text

  - name: structure
    agent: data-structurer
    prompt: "Structure {raw_text} into sections"
    output: structured_data

  - name: analyze
    agent: content-analyzer
    prompt: "Analyze {structured_data} for insights"
    output: insights

  - name: summarize
    agent: summarizer
    prompt: "Summarize {insights} in 3 paragraphs"
    output: summary
```

### Agent Inheritance Pattern

```yaml
# Base agent
# agents/specs/base-coder.yaml
name: base-coder
provider: openai
model: gpt-4
temperature: 0.3
system_prompt: |
  You are a software engineer.

# Specialized agent (references base)
# agents/specs/python-coder.yaml
name: python-coder
extends: base-coder           # Inherit from base
temperature: 0.2              # Override temperature
system_prompt: |
  You are a Python expert.    # Override prompt
  Follow PEP 8 guidelines.
```

## Troubleshooting

```bash
# Validate YAML
python -c "import yaml; yaml.safe_load(open('.parac/project.yaml'))"

# Check for secrets
grep -rn "sk-\|api_key.*:" .parac/ --exclude-dir=logs

# Verify agent references
agent_name="code-assistant"
grep -q "name: $agent_name" .parac/agents/manifest.yaml && echo "✓ Found" || echo "✗ Missing"

# Test configuration loading
paracle validate .parac/

# Check logs
tail -f .parac/logs/errors/*.log
```

---

**Key Principles**:
- Security first, always
- Validate before deploying
- Document your configurations
- Use environment variables for secrets
- Test incrementally
