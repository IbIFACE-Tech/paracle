# Mistral Codestral Guide for Paracle .parac Configuration

## Introduction

Guide for Mistral Codestral when working with Paracle's `.parac/` configuration system. Focus on code generation and configuration management for multi-agent AI applications.

## Core Structure

```
.parac/
├── project.yaml          # Main config ⚡
├── agents/              # Agent defs
├── workflows/           # Workflows
├── tools/               # Tools
├── policies/            # Security
└── memory/              # Knowledge
```

## Configuration Principles

### 1. Schema Compliance
```yaml
schema_version: "1.0"    # Required in all YAML files
```

### 2. Naming
- **Files**: lowercase-with-hyphens.yaml
- **Agents**: descriptive-role-name
- **Variables**: snake_case

### 3. Security
- Tools disabled by default
- Content filtering enabled
- No hardcoded secrets
- Use environment variables

## Project Configuration

```yaml
# .parac/project.yaml
name: project-name
version: 0.1.0
description: "Project description"
schema_version: "1.0"

defaults:
  python_version: "3.10"
  model_provider: openai       # openai | anthropic | google | local
  default_model: gpt-4
  temperature: 0.7

features:
  enable_mcp: true
  enable_api: true
  enable_events: true
```

## Agent Configuration

### Manifest
```yaml
# agents/manifest.yaml
schema_version: "1.0"
agents:
  - name: code-assistant
    spec_file: specs/code-assistant.yaml
    enabled: true
    version: 1.0.0
```

### Specification
```yaml
# agents/specs/code-assistant.yaml
name: code-assistant
provider: openai
model: gpt-4
temperature: 0.3              # Lower for code

system_prompt: |
  You are an expert software engineer.
  Write clean, maintainable code following best practices.

# Assign skills
skills:
  - question-answering
  - code-generation
  - data-analysis

tools:
  - file_system
  - code_executor

memory:
  enabled: true
```

### Agent Skills

**Two formats:**

1. **YAML** (quick): `.parac/agents/skills/custom/skill.yaml`
2. **SKILL.md** (detailed): `.parac/agents/skills/custom/skill/SKILL.md`

**YAML:**
```yaml
name: api-client
category: integration    # communication|analysis|creation|transformation|integration|memory
level: advanced          # basic|intermediate|advanced|expert
description: Build REST/GraphQL APIs
tools: [http_client]
```

**SKILL.md:**
```markdown
---
name: api-client
description: API integration
metadata:
  category: integration
  level: advanced
---
# API Client
[Code examples]
```

**Built-in:** question-answering, code-generation, data-analysis, text-summarization, api-integration
  Write clean, efficient, well-documented code.
  Follow language best practices.

tools:
  - name: file_system
    enabled: true
    permissions: [read, write]
```

## Workflow Configuration

```yaml
# workflows/templates/code-review.yaml
name: code-review
version: 1.0.0

inputs:
  - name: file_path
    type: string
    required: true

steps:
  - name: analyze
    agent: code-assistant
    prompt: "Review code in {file_path}"
    output: review

outputs:
  - name: result
    value: "{review}"
```

## Code Generation Patterns

### Agent Spec Template
```yaml
name: {{ agent_name }}
description: "{{ description }}"
version: 1.0.0

provider: {{ provider }}
model: {{ model }}
temperature: {{ temperature }}

system_prompt: |
  {{ system_prompt }}

capabilities:
  - {{ capability_1 }}
  - {{ capability_2 }}
```

### Workflow Template
```yaml
name: {{ workflow_name }}
version: 1.0.0

inputs:
  - name: {{ input_name }}
    type: {{ type }}
    required: {{ required }}

steps:
  - name: {{ step_name }}
    agent: {{ agent_name }}
    prompt: "{{ prompt }}"
    output: {{ output_var }}

outputs:
  - name: result
    value: "{{{ output_var }}}"
```

### Tool Registry Template
```yaml
schema_version: "1.0"

builtin_tools:
  - name: {{ tool_name }}
    enabled: false            # Security: disabled by default
    permissions: [{{ perms }}]
```

## Temperature Guide

```python
# Code generation/review
TEMPERATURE_CODE = 0.2-0.3

# Data processing
TEMPERATURE_DATA = 0.3-0.5

# General tasks
TEMPERATURE_GENERAL = 0.5-0.7

# Creative content
TEMPERATURE_CREATIVE = 0.8-1.0
```

## Model Selection

```yaml
# Complex reasoning, production code
model: gpt-4

# Simple tasks, high volume
model: gpt-3.5-turbo

# Long context, detailed analysis
model: claude-3-opus-20240229

# Local deployment
provider: local
model: codestral
```

## Security Patterns

### Secure Tool Configuration
```yaml
builtin_tools:
  - name: file_system
    enabled: false           # ✅ Disabled by default
    permissions: [read]      # ✅ Minimal permissions
    allowed_paths:           # ✅ Path restrictions
      - /tmp
      - ./data
    blocked_paths:           # ✅ Explicit blocks
      - /etc
      - ~/.ssh
```

### Content Filtering
```yaml
content_filtering:
  enabled: true              # ✅ Always on
  filter_pii: true           # ✅ Protect privacy
  filter_harmful: true       # ✅ Safety

  blocked_patterns:
    - "(?i)password\\s*[:=]"
    - "(?i)api[_-]?key\\s*[:=]"
    - "-----BEGIN.*PRIVATE KEY"
```

### Rate Limiting
```yaml
rate_limiting:
  enabled: true
  requests_per_minute: 60
  requests_per_hour: 1000
  burst_size: 10
```

## Validation Functions

```python
import yaml
from typing import Dict, Any

def validate_yaml_syntax(file_path: str) -> bool:
    """Validate YAML syntax."""
    try:
        with open(file_path) as f:
            yaml.safe_load(f)
        return True
    except yaml.YAMLError as e:
        print(f"YAML Error: {e}")
        return False

def validate_schema_version(config: Dict[str, Any]) -> bool:
    """Check schema version."""
    return config.get('schema_version') == '1.0'

def validate_agent_spec(spec: Dict[str, Any]) -> bool:
    """Validate agent specification."""
    required = ['name', 'provider', 'model', 'system_prompt']
    return all(field in spec for field in required)

def check_for_secrets(file_path: str) -> bool:
    """Check for hardcoded secrets."""
    with open(file_path) as f:
        content = f.read()

    patterns = [
        r'sk-[a-zA-Z0-9]{48}',           # OpenAI key
        r'sk-ant-[a-zA-Z0-9-]{95}',      # Anthropic key
        r'api[_-]?key\s*[:=]\s*["\'][^"\']+["\']'
    ]

    import re
    for pattern in patterns:
        if re.search(pattern, content, re.IGNORECASE):
            return False
    return True
```

## Code Generation Functions

```python
def generate_agent_spec(
    name: str,
    provider: str = "openai",
    model: str = "gpt-4",
    temperature: float = 0.7,
    system_prompt: str = "",
    capabilities: list = None
) -> str:
    """Generate agent specification YAML."""
    spec = {
        'name': name,
        'description': f"{name.replace('-', ' ').title()} agent",
        'version': '1.0.0',
        'provider': provider,
        'model': model,
        'temperature': temperature,
        'system_prompt': system_prompt or f"You are a {name.replace('-', ' ')}.",
        'capabilities': capabilities or []
    }
    return yaml.dump(spec, default_flow_style=False, sort_keys=False)

def generate_workflow(
    name: str,
    steps: list,
    inputs: list = None
) -> str:
    """Generate workflow YAML."""
    workflow = {
        'name': name,
        'version': '1.0.0',
        'inputs': inputs or [],
        'steps': steps,
        'outputs': []
    }
    return yaml.dump(workflow, default_flow_style=False, sort_keys=False)
```

## CLI Helpers

```bash
# Initialize project
init_project() {
    cp -r templates/.parac-template .parac
    echo "✓ Project initialized"
}

# Create agent
create_agent() {
    local name=$1
    local spec_file=".parac/agents/specs/${name}.yaml"

    cat > "$spec_file" << EOF
name: ${name}
provider: openai
model: gpt-4
temperature: 0.7
system_prompt: |
  You are ${name//-/ }.
EOF

    echo "✓ Agent created: $spec_file"
}

# Validate configuration
validate_config() {
    python -c "import yaml; yaml.safe_load(open('.parac/project.yaml'))"
    echo "✓ Configuration valid"
}

# Check security
check_security() {
    grep -rn "sk-\|api.*key.*:" .parac/ --exclude-dir=logs \
        && echo "⚠ Potential secrets found" \
        || echo "✓ No secrets detected"
}
```

## Best Practices Checklist

```yaml
# Before committing
validation:
  - [ ] YAML syntax valid
  - [ ] schema_version present
  - [ ] Required fields populated
  - [ ] Agent references valid
  - [ ] No hardcoded secrets
  - [ ] Tools properly restricted
  - [ ] Security policies enabled
  - [ ] Documentation updated
  - [ ] Tests passing
```

## Quick Commands

```bash
# Validate
python -c "import yaml; yaml.safe_load(open('.parac/project.yaml'))"

# Check secrets
grep -r "api.*key.*:" .parac/ --exclude-dir=logs

# List agents
yq '.agents[].name' .parac/agents/manifest.yaml

# Enable agent
yq -i '.agents[] | select(.name == "my-agent") | .enabled = true' \
  .parac/agents/manifest.yaml
```

## Anti-Patterns

```yaml
# ❌ Don't do this
api_key: sk-1234567890...        # Hardcoded secret
name: Agent1                     # Non-descriptive
temperature: 2.0                 # Invalid range
enabled: true                    # Tool enabled by default

# ✅ Do this
# api_key: set via OPENAI_API_KEY
name: code-reviewer
temperature: 0.7
enabled: false
```

## Environment Variables

```bash
# Required
export OPENAI_API_KEY="sk-..."
export ANTHROPIC_API_KEY="sk-ant-..."

# Optional
export PARACLE_ENV="development"
export PARACLE_LOG_LEVEL="INFO"
```

## Quick Reference

```yaml
# Agent
name: agent-name
provider: openai
model: gpt-4
temperature: 0.7
system_prompt: |
  Role and instructions

# Workflow
name: workflow-name
steps:
  - name: step1
    agent: agent-name
    prompt: "Task"
    output: result

# Security
content_filtering:
  enabled: true
rate_limiting:
  enabled: true
```

---

**Key Points**:
- Validate before committing
- Security by default
- No hardcoded secrets
- Clear naming
- Document everything
