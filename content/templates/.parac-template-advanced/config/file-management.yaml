# File Management Configuration (Optional)
# Comprehensive configuration for logs, ADRs, and roadmaps
# All paths are relative to .parac/ unless otherwise specified
#
# IMPORTANT: These limits are SOFT LIMITS (documentation/guidance) and are NOT
# actively enforced at runtime in the current implementation. They serve as:
# - Best practice guidelines for contributors
# - Design targets for future enforcement
# - Documentation of intended system behavior
#
# Future versions may implement hard enforcement with validation/truncation.

file_management:
  # ===========================================================================
  # LOG FILES CONFIGURATION
  # ===========================================================================
  logs:
    base_path: memory/logs # Relative to .parac/

    # Global log settings
    global:
      # Line/entry limits (SOFT LIMITS - not enforced)
      # Best practices: Keep log lines under 1000 chars for readability
      # Longer lines make debugging difficult and slow down log parsing tools
      max_line_length: 1000 # Max characters per log line (recommended limit)
      max_message_length: 500 # Max characters for message field
      max_description_length: 300 # Max characters for description field
      max_file_size_mb: 50 # Max log file size before rotation (MB)
      max_total_size_mb: 500 # Max total size of all logs (MB)

      # Timestamp settings
      timestamp_format: "%Y-%m-%d %H:%M:%S" # ISO 8601 compatible
      timezone: UTC # UTC, local, or specific timezone

      # Rotation settings (defaults for all logs)
      default_rotation: none # none, daily, weekly, monthly, size
      default_retention_days: null # null = permanent, number = days to keep
      compress_rotated: true # Compress rotated log files (.gz)
      backup_count: 10 # Number of rotated files to keep

      # Performance
      buffer_size: 8192 # Write buffer size in bytes
      flush_interval_seconds: 5 # Auto-flush interval (0 = immediate)
      async_logging: true # Use async writes for performance

    # Pre-defined log categories
    predefined:
      actions:
        enabled: true
        path: agent_actions.log
        format: "[{timestamp}] [{agent}] [{action}] {description}"
        description: "Agent actions and activities"
        # Limits (SOFT - not enforced)
        # Best practice: 800 chars covers timestamp + agent + action + detailed description
        max_entries: null # null = unlimited, number = max entries
        max_file_size_mb: 25 # Keep manageable for git versioning
        max_line_length: 800 # Recommended max for action logs
        # Rotation
        rotation: none # Governance logs are versioned in git
        retention_days: null # Permanent
        # Fields
        required_fields: [timestamp, agent, action, description]
        optional_fields: [details, context, duration_ms]

      decisions:
        enabled: true
        path: decisions.log
        format: "[{timestamp}] [{agent}] [DECISION] {decision} | {rationale} | {impact}"
        description: "Important decisions made by agents"
        # Limits (SOFT - not enforced)
        # Decisions need more space for rationale + impact analysis
        max_file_size_mb: 10
        max_line_length: 1200 # Longer for decision rationale
        rotation: none
        retention_days: null # Permanent - decisions are historical record
        required_fields: [timestamp, agent, decision]
        optional_fields: [rationale, impact, alternatives, references]

      security:
        enabled: false
        path: security/security.log
        format: structured_json # JSON format for security analysis
        description: "Security events and audit trail"
        # Limits (SOFT - not enforced)
        max_file_size_mb: 50
        max_line_length: 1500 # Security events need detail
        rotation: daily
        retention_days: 365 # 1 year for compliance
        compress_rotated: true
        required_fields: [timestamp, level, event_type, actor]
        optional_fields: [resource, action, outcome, ip_address, user_agent]
        # Security-specific settings
        include_stack_trace: false # Include stack traces in errors
        redact_sensitive: true # Auto-redact PII/secrets

      performance:
        enabled: false
        path: performance/metrics.log
        format: structured_json
        description: "Performance metrics and timing data"
        # Limits (SOFT - not enforced)
        max_file_size_mb: 100
        max_line_length: 1000 # Structured JSON metrics
        rotation: daily
        retention_days: 30
        compress_rotated: true
        required_fields: [timestamp, metric_name, value]
        optional_fields: [unit, tags, percentiles, histogram]
        # Performance-specific settings
        sample_rate: 1.0 # 1.0 = 100%, 0.1 = 10% sampling
        include_percentiles: true # Calculate p50, p95, p99

      risk:
        enabled: false
        path: risk/risk_log.log
        format: "[{timestamp}] [{level}] [{category}] {message}"
        description: "Risk assessments and warnings"
        # Limits (SOFT - not enforced)
        max_file_size_mb: 25
        max_line_length: 800 # Risk assessments should be concise
        rotation: daily
        retention_days: 90
        required_fields: [timestamp, level, message]
        optional_fields: [category, severity, mitigation, owner]
        # Risk levels: INFO, LOW, MEDIUM, HIGH, CRITICAL
        min_level: LOW # Minimum level to log

      errors:
        enabled: true
        path: errors/error.log
        format: structured_json
        description: "Error and exception logging"
        # Limits (SOFT - not enforced)
        # Errors need space for stack traces
        max_file_size_mb: 50
        max_line_length: 2000 # Longer for stack traces
        rotation: daily
        retention_days: 90
        compress_rotated: true
        required_fields: [timestamp, level, message, error_type]
        optional_fields: [stack_trace, context, request_id, user_id]
        include_stack_trace: true

    # Custom log files (user-defined)
    custom: []

  # ===========================================================================
  # ADR (ARCHITECTURE DECISION RECORDS) CONFIGURATION
  # ===========================================================================
  adr:
    base_path: roadmap/adr # Relative to .parac/
    enabled: true
    format: markdown # markdown or yaml

    # File settings
    index_file: index.md # Summary/index of all ADRs
    file_extension: .md # .md or .yaml
    encoding: utf-8

    # Content limits (SOFT LIMITS - not enforced)
    # Best practices for ADRs: Concise but complete
    # Each section should be focused - if hitting limits, consider splitting the ADR
    limits:
      max_title_length: 120 # Keep titles scannable (git log, index)
      max_context_length: 3000 # Enough for problem statement + background
      max_decision_length: 2000 # Focus on "what" and "why", not implementation details
      max_consequences_length: 2000 # Cover benefits, drawbacks, risks
      max_implementation_length: 3000 # High-level implementation guidance
      max_related_length: 500 # List of related ADR IDs + brief notes
      max_total_length: 15000 # Total ADR size (encourage focused decisions)
      max_adrs: null # null = unlimited, number = max ADRs

    # Auto-numbering configuration
    auto_number: true
    number_format: "ADR-{:03d}" # ADR-001, ADR-002, etc.
    number_start: 1 # Starting number for new projects
    number_padding: 3 # Zero-padding width (3 = 001, 4 = 0001)

    # Status management
    statuses:
      - name: Proposed
        description: "Under discussion, not yet decided"
        color: yellow
        transitions: [Accepted, Rejected, Withdrawn]
      - name: Accepted
        description: "Approved and should be followed"
        color: green
        transitions: [Deprecated, Superseded]
      - name: Deprecated
        description: "No longer valid, kept for history"
        color: gray
        transitions: []
      - name: Superseded
        description: "Replaced by another ADR"
        color: blue
        transitions: []
      - name: Rejected
        description: "Considered but not accepted"
        color: red
        transitions: []
      - name: Withdrawn
        description: "Withdrawn before decision"
        color: gray
        transitions: []
    default_status: Proposed

    # Default values
    defaults:
      deciders: "Core Team"
      implementation: "TBD"
      related: "None"

    # Template (Markdown format)
    template: |
      # {id}: {title}

      **Date**: {date}
      **Status**: {status}
      **Deciders**: {deciders}

      ## Context

      {context}

      ## Decision

      {decision}

      ## Consequences

      {consequences}

      ## Implementation

      {implementation}

      ## Related Decisions

      {related}

    # Index file template
    index_template: |
      # Architecture Decision Records

      This directory contains Architecture Decision Records (ADRs) for the project.

      ## ADR Index

      | ID | Title | Status | Date |
      |---|---|---|---|
      {adr_table}

      ## Statuses

      - **Proposed**: Under discussion
      - **Accepted**: Approved and implemented
      - **Deprecated**: No longer valid
      - **Superseded**: Replaced by another ADR
      - **Rejected**: Considered but not accepted

      *Last updated: {last_updated}*

    # Migration settings
    legacy_file: roadmap/decisions.md # Original single-file location
    migrate_on_init: false # Auto-migrate on initialization
    backup_before_migrate: true # Create backup before migration

    # Validation
    validation:
      require_context: true # Context section required
      require_decision: true # Decision section required
      require_consequences: true # Consequences section required
      require_deciders: false # Deciders field required
      validate_links: true # Validate related ADR links exist
      warn_empty_sections: true # Warn on empty optional sections

  # ===========================================================================
  # ROADMAP CONFIGURATION
  # ===========================================================================
  roadmap:
    base_path: roadmap # Relative to .parac/

    # Primary roadmap (required)
    primary: roadmap.yaml
    primary_description: "Main project roadmap"

    # Content limits (SOFT LIMITS - not enforced)
    # Best practices for roadmaps: Keep entries scannable and focused
    # YAML readability: Lines should wrap at ~120 chars for diff-friendly viewing
    limits:
      max_phase_name_length: 80 # Keep phase names concise (appears in lists, logs)
      max_phase_description_length: 1000 # Focused description, not documentation
      max_deliverable_name_length: 120 # Readable in tables and lists
      max_deliverable_description_length: 500 # Brief description, link to docs for details
      max_line_length_yaml: 120 # YAML line length (best practice for diffs/readability)
      max_phases: 50 # Max phases per roadmap
      max_deliverables_per_phase: 100 # Max deliverables per phase
      max_roadmaps: 20 # Max total roadmaps

    # Phase configuration
    phases:
      # Valid statuses for phases
      statuses:
        - name: pending
          description: "Not yet started"
          color: gray
        - name: in_progress
          description: "Currently being worked on"
          color: yellow
        - name: completed
          description: "Successfully finished"
          color: green
        - name: blocked
          description: "Cannot proceed due to blockers"
          color: red
        - name: on_hold
          description: "Temporarily paused"
          color: orange
        - name: cancelled
          description: "Will not be completed"
          color: gray
      default_status: pending

      # Progress tracking
      progress:
        min: 0 # Minimum progress value
        max: 100 # Maximum progress value
        unit: "%" # Display unit
        auto_calculate: false # Auto-calculate from deliverables

    # Deliverable configuration
    deliverables:
      statuses: [pending, in_progress, completed, blocked, cancelled]
      default_status: pending
      track_completion_date: true # Record when completed
      require_owner: false # Require owner assignment

    # Additional roadmaps (optional, user-defined)
    additional: []

    # Synchronization settings
    sync:
      enabled: true
      validate_on_sync: true # Validate before syncing
      auto_update_state: true # Update current_state.yaml on sync
      sync_interval_minutes: null # null = manual only, number = auto-sync
      conflict_resolution: roadmap # roadmap or state (which wins on conflict)

    # Validation
    validation:
      require_phase_id: true # Phase ID required
      require_phase_name: true # Phase name required
      unique_phase_ids: true # Phase IDs must be unique
      validate_progress_range: true # Progress must be 0-100
      validate_date_order: true # start_date must be before end_date
      warn_no_current_phase: true # Warn if no phase is in_progress
      warn_multiple_in_progress: true # Warn if multiple phases in_progress

    # Export settings
    export:
      formats: [yaml, json, markdown, html]
      default_format: yaml
      include_metadata: true # Include timestamps, version info
