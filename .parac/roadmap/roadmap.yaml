# Paracle v0.0.1 - Roadmap Canonique
# Status: Active | Version: 1.1 | Verrouillable: true

version: 0.0.1
timeline: 32_weeks # Extended from 17 weeks
status: in_progress
current_phase: phase_5
last_update: "2026-01-05"

# =============================================================================
# PERSISTENCE STRATEGY (ADR-015)
# =============================================================================
persistence_strategy:
  description: |
    Hybrid persistence architecture with three layers:
    1. YAML/Markdown files - Human-readable configs (source of truth for definitions)
    2. SQLite/PostgreSQL - Runtime data (executions, events, audit)
    3. ChromaDB/pgvector - Vector storage (RAG, memory, embeddings)

  layers:
    - id: file_layer
      name: "YAML/Markdown Files"
      scope: "Configuration & Definitions"
      status: implemented
      location: ".parac/"
      contents:
        - "Agent specifications (.parac/agents/specs/)"
        - "Workflow definitions (.parac/workflows/)"
        - "Tool configurations"
        - "Governance state (roadmap, decisions)"
        - "Project configuration"
      benefits:
        - "Human-readable and editable"
        - "Git-friendly (version control)"
        - "Declarative configuration"
        - "Zero external dependencies"

    - id: relational_layer
      name: "SQLite → PostgreSQL"
      scope: "Runtime Data"
      status: implementing # Phase 4
      versions:
        v0.0.1: "SQLite (file-based, zero config)"
        v0.5.0: "PostgreSQL option (scaling)"
      contents:
        - "Agent runtime instances"
        - "Workflow executions and results"
        - "Event history"
        - "Audit logs (ISO 42001)"
        - "Session data"
      benefits:
        - "ACID transactions"
        - "Queryable history"
        - "Scalable to production"

    - id: vector_layer
      name: "ChromaDB → pgvector"
      scope: "AI-Native Storage"
      status: planned # Phase 6
      versions:
        v0.5.0: "ChromaDB (embedded, simple)"
        v0.7.0: "pgvector option (unified)"
      contents:
        - "Document embeddings (RAG)"
        - "Agent memory"
        - "Semantic code search"
        - "Conversation history"
      benefits:
        - "Similarity search"
        - "Context retrieval"
        - "Long-term memory"

  migration_path:
    - version: "v0.0.1"
      storage: "YAML + SQLite"
      description: "Config in files, runtime in SQLite"
    - version: "v0.1.0"
      storage: "+ Event persistence"
      description: "Persistent event store"
    - version: "v0.5.0"
      storage: "+ ChromaDB"
      description: "RAG and embeddings"
    - version: "v0.7.0"
      storage: "+ PostgreSQL option"
      description: "Production scaling"
    - version: "v1.0.0"
      storage: "+ pgvector"
      description: "Unified relational + vector"

# CLI Commands Roadmap Summary
cli_roadmap:
  total_commands: 81 # +6 task/board commands (ADR-021)
  implemented: 31 # Updated: +6 cost commands
  planned: 50 # Updated after cost implementation

  # Priority 0 - Essential (Phase 3-4)
  p0_essential:
    - command: paracle serve
      status: implemented
      phase: phase_3
      description: "Start API server (FastAPI)"
    - command: paracle agents create
      status: planned
      phase: phase_5
      description: "Create agent from template"
    - command: paracle agents run
      status: planned
      phase: phase_5
      description: "Run agent interactively"

  # Priority 1 - Core Features (Phase 2-4)
  p1_core:
    - paracle workflow list/run/status/cancel # Implemented
    - paracle tools list/info/register/test # Implemented
    - paracle providers list/add/test/default # Implemented

  # Priority 2 - Developer Experience (Phase 4)
  p2_devex:
    - paracle dev
    - paracle logs
    - paracle events list/replay
    - paracle config show/set/get/env

  # Priority 3 - Execution Safety (Phase 5)
  p3_safety:
    - paracle sandbox create/list/cleanup
    - paracle review list/approve/reject

  # Priority 4 - Iteration & Profiles (Phase 6)
  p4_iteration:
    - paracle workflow retry/continue
    - paracle profiles list/create
    - paracle agents switch-model
    - paracle task list/create/move/assign/view # ADR-021 Kanban
    - paracle board show/stats # ADR-021 Kanban

  # Priority 5 - Git Integration (Phase 7)
  p5_git:
    - paracle git init/branches/merge/pr-create/cleanup

  # Priority 6 - Monitoring & Templates (Phase 8)
  p6_monitoring:
    - paracle stream/pause/resume
    - paracle init --template
    - paracle templates list
    - paracle history compare

  # Priority 7 - Notifications (Phase 9)
  p7_notifications:
    - paracle notify configure
    - paracle alerts list
    - paracle replay
    - paracle compare

# Recent Achievements
recent_achievements:
  - id: cost_management_system
    name: "Comprehensive Cost Management System"
    completed: "2026-01-05"
    impact: high
    description: |
      Full cost tracking, budget enforcement, and reporting system:
      - Cost calculation from model pricing (per million tokens)
      - Budget enforcement with daily/monthly/workflow/total limits
      - Alert thresholds (warning at 80%, critical at 95%)
      - SQLite persistence for cost records
      - Integration with workflow execution via ExecutionCost
    deliverables:
      - CostTracker with budget enforcement
      - CostConfig with project.yaml integration
      - BudgetExceededError for blocking mode
      - ExecutionCost in workflow context
      - CLI commands: paracle cost report/usage/budget/estimate/pricing/cleanup
      - 22 unit tests with full coverage

  - id: log_management_implementation
    name: "Enterprise Log Management System"
    completed: "2026-01-05"
    impact: high
    description: |
      CrowdStrike best-practice log management with centralized aggregation,
      search, indexing, anomaly detection, and compliance reporting.
    deliverables:
      - LogManager with SQLite FTS5 indexing
      - Search/aggregate/stats APIs
      - Compliance reporting (ISO42001, GDPR)
      - Log compression and retention policies
      - CLI commands: paracle logs search/aggregate/stats/anomalies

  - id: phase_4_api_cli
    name: "Phase 4 API & CLI Enhancement"
    completed: "2026-01-04"
    impact: critical
    description: |
      Comprehensive API server with security, CLI commands, and MCP integration.
      613 tests passing, 87.5% coverage.
    deliverables:
      - REST API with 47+ endpoints (11 routers)
      - JWT authentication
      - Rate limiting and security headers
      - Workflow execution endpoints
      - CLI commands for workflow, tools, providers
      - Approval workflow system (API + routes)
      - IDE sync commands (5 IDE formats)

  - id: package_uniformization
    name: "Package Uniformization"
    completed: "2026-01-04"
    impact: medium
    description: |
      Standardized all package __init__.py files with proper exports.
      Unified exception handling with error codes.
    deliverables:
      - Consistent __all__ exports
      - Error codes (PARACLE-XXX-NNN)
      - Removed empty directories

  - id: phase_0_foundation
    name: "Phase 0 Foundation Complete"
    completed: "2025-12-24"
    impact: critical
    description: |
      Foundation phase completed ahead of schedule.
      All infrastructure, CI/CD, documentation, and project structure in place.
    deliverables:
      - Repository structure (packages/, tests/, docs/)
      - pyproject.toml with uv
      - GitHub Actions CI/CD
      - Basic documentation
      - Hello world CLI

# Global Metrics (Aligned with ROADMAP_GLOBALE)
metrics:
  time_to_first_agent: "<5min"
  test_coverage: ">87%"
  documentation_coverage: "100%"
  api_response_p95: "<500ms"
  breaking_changes: 0
  tests_passing: 613

# New Capabilities Roadmap (Community Edition)
new_capabilities:
  execution_safety:
    description: "Production-grade execution isolation and safety"
    features:
      - Docker-based sandboxing
      - Resource limits and monitoring
      - Automatic rollback mechanisms
      - Artifact review and approval workflow
    target_version: "v0.1.0"

  iterative_execution:
    description: "AI-friendly retry and refinement workflows"
    features:
      - Follow-up execution with feedback
      - Human-in-the-loop workflows
      - Conditional retry logic
      - Context accumulation across attempts
    target_version: "v0.1.0"

  agent_profiles:
    description: "Flexible agent configuration management"
    features:
      - Multiple profiles per agent (variants)
      - Model switching per task type
      - Permission levels and autonomy settings
      - Context templates per profile
    target_version: "v0.1.0"

  git_integration:
    description: "Version control for AI-generated changes"
    features:
      - Branch per execution
      - Automatic commits and audit trail
      - PR/MR generation
      - Conflict resolution
    target_version: "v0.2.0"

  realtime_monitoring:
    description: "Live execution visibility and control"
    features:
      - WebSocket streaming API
      - Pause/resume/cancel controls
      - Progress indicators
      - Resource monitoring
    target_version: "v0.2.0"

  templates_quickstart:
    description: "Accelerated project setup"
    features:
      - Pre-built workflow templates
      - Quick-start wizards
      - Example gallery
      - Agent packs
    target_version: "v0.2.0"

  advanced_features:
    description: "Enterprise-grade observability"
    features:
      - Multi-channel notifications
      - Time travel debugging
      - A/B testing for agent configs
      - Comprehensive cost tracking
    target_version: "v0.2.0"

# Phases
phases:
  - id: phase_0
    name: "Foundation & Setup"
    duration: 1_week
    status: completed
    completed_date: "2025-12-24"
    priority: critical
    completion: 100%
    deliverables:
      - repository_structure
      - pyproject_toml
      - ci_cd_pipeline
      - basic_documentation
      - hello_world
    outcomes:
      - "10 packages structure created"
      - "CI/CD with GitHub Actions"
      - "Documentation framework"
      - "CLI hello command working"

  - id: phase_1
    name: "Core Domain"
    duration: 3_weeks
    status: completed
    started_date: "2025-12-24"
    completed_date: "2026-01-02"
    priority: critical
    completion: 100%
    deliverables:
      - domain_models
      - in_memory_persistence
      - event_bus
      - agent_inheritance
      - repository_pattern
    focus_areas:
      - "Agent inheritance resolution algorithm"
      - "Repository pattern (in-memory)"
      - "Event bus implementation"
      - "80%+ test coverage"
      - "Full CRUD operations"

  - id: phase_2
    name: "Multi-Provider & Multi-Framework"
    duration: 4_weeks
    status: completed
    completed_date: "2026-01-02"
    priority: high
    completion: 100%
    deliverables:
      - llm_abstraction
      - provider_adapters
      - framework_adapters
      - mcp_protocol
      - agent_factory

  - id: phase_3
    name: "Orchestration & API"
    duration: 4_weeks
    status: completed
    completed_date: "2026-01-04"
    priority: high
    completion: 100%
    deliverables:
      - workflow_orchestrator
      - rest_api
      - authentication
      - state_management_rollback
      - security_middleware

  - id: phase_4
    name: "Persistence & Production Scale"
    duration: 3_weeks
    status: completed
    completed_date: "2026-01-05"
    priority: high
    completion: 100%
    deliverables:
      - sqlite_persistence
      - database_migrations
      - storage_configuration
      - performance_optimization
      - observability
      - error_management_hardening
      - log_management_system # IMPLEMENTED - LogManager with search/aggregate
      - approval_workflow_api # IMPLEMENTED - Approval system (API routes)
      - yolo_mode # IMPLEMENTED - Auto-approve workflows (YOLO mode)
      - plan_mode # IMPLEMENTED - Workflow execution plan preview with cost/time estimates
      - dry_run_mode # IMPLEMENTED - Mock execution for testing with FIXED/RANDOM/ECHO strategies
      - ide_sync_generator # IMPLEMENTED - IDE instructions for 5 IDEs
      - cost_management_system # IMPLEMENTED - Full cost tracking and budget enforcement
      - mcp_tool_integration # IMPLEMENTED - Model Context Protocol CLI commands
      - pre_commit_hooks # VALIDATED - Comprehensive governance hooks configured
      - ci_cd_workflow_testing # VALIDATED - Matrix testing (3 OS × 3 Python versions)
    focus_areas:
      - "SQLite persistence layer"
      - "Alembic migrations"
      - "Storage configuration system"
      - "Repository SQLite implementations"
      - "Log aggregation and analysis (CrowdStrike best practices)"
      - "YOLO mode for auto-approving workflows (CI/CD support)"
      - "Plan Mode for workflow execution preview (DAG analysis)"
      - "Dry-Run Mode for cost-free testing (mocked LLM responses)"
      - "Approval workflow for agent artifacts"
      - "YOLO mode for auto-approving workflows (CI/CD support)"
    cli_commands:
      implemented:
        - paracle logs search # Search logs with filters
        - paracle logs aggregate # Aggregate log metrics
        - paracle logs stats # Log statistics
        - paracle logs anomalies # Detect anomalies
        - paracle logs cleanup # Clean old logs
        - paracle logs compress # Compress logs
        - paracle ide init # Initialize IDE configs
        - paracle ide sync # Sync IDE instructions
        - paracle ide list # List IDE integrations
        - paracle cost report # Generate cost report
        - paracle cost usage # View usage statistics
        - paracle cost budget # View budget status
        - paracle cost estimate # Estimate request cost
        - paracle cost pricing # Show model pricing
        - paracle cost cleanup # Clean old cost records
      planned:
        - paracle events list # Show recent events
        - paracle config show # Show configuration
        - paracle health # Health check

  - id: phase_5
    name: "Execution Safety & Isolation"
    duration: 3_weeks
    status: in_progress
    started_date: "2026-01-05"
    priority: high
    completion: 0%
    deliverables:
      - sandbox_execution
      - docker_isolation
      - resource_limits
      - rollback_mechanisms
      - artifact_review_system
    focus_areas:
      - "Docker-based agent sandboxing"
      - "Resource limits (CPU, memory, timeout)"
      - "Filesystem isolation per execution"
      - "Automatic rollback on failure"
      - "Artifact review and approval workflow (API)"
    cli_commands:
      planned:
        - paracle sandbox create # Create isolated environment
        - paracle sandbox list # List active sandboxes
        - paracle sandbox cleanup # Clean up sandboxes
        - paracle review list # List pending reviews
        - paracle review approve # Approve artifact changes
        - paracle review reject # Reject with feedback

  - id: phase_6
    name: "Iterative Execution & Agent Profiles"
    duration: 3_weeks
    status: planned
    priority: high
    completion: 0%
    deliverables:
      - execution_chains
      - follow_up_mechanism
      - agent_profiles
      - human_in_the_loop
      - conditional_retry
      - kanban_task_management # ADR-021
    focus_areas:
      - "Follow-up execution with feedback loop"
      - "Agent configuration profiles (variants)"
      - "Human-in-the-loop workflows (pause/review/continue)"
      - "Conditional retry based on validation"
      - "Context accumulation across attempts"
      - "Model switching per task type"
      - "Kanban task management (ADR-021)"
    cli_commands:
      planned:
        - paracle workflow retry # Retry with feedback
        - paracle workflow continue # Continue paused workflow
        - paracle profiles list # List agent profiles
        - paracle profiles create # Create profile variant
        - paracle agents switch-model # Switch LLM mid-workflow
        - paracle task list # List tasks by status
        - paracle task create # Create new task
        - paracle task move # Move task to status
        - paracle task assign # Assign to agent
        - paracle board show # Show Kanban board (CLI)
        - paracle board stats # Board statistics

  - id: phase_7
    name: "Git Integration & Change Tracking"
    duration: 3_weeks
    status: planned
    priority: medium
    completion: 0%
    deliverables:
      - git_workflow_manager
      - branch_per_execution
      - automatic_commits
      - merge_request_generation
      - conflict_resolution
    focus_areas:
      - "Git-backed workflow execution"
      - "Branch per execution for isolation"
      - "Automatic commit of agent changes"
      - "GitHub/GitLab MR/PR generation"
      - "Conflict resolution for concurrent executions"
      - "Audit trail via git history"
    cli_commands:
      planned:
        - paracle git init # Initialize git workflow
        - paracle git branches # List execution branches
        - paracle git merge # Merge execution branch
        - paracle git pr-create # Create pull request
        - paracle git cleanup # Cleanup merged branches

  - id: phase_8
    name: "Real-time Monitoring & Templates"
    duration: 2_weeks
    status: planned
    priority: medium
    completion: 0%
    deliverables:
      - websocket_streaming
      - process_control
      - workflow_templates
      - quick_start_wizards
      - execution_history
    focus_areas:
      - "WebSocket API for live execution streaming"
      - "Pause/resume/cancel workflow controls"
      - "Progress indicators and resource monitoring"
      - "Pre-built workflow templates (RAG, multi-agent, etc.)"
      - "Quick-start wizards for common patterns"
      - "Execution versioning and comparison"
    cli_commands:
      planned:
        - paracle stream # Stream live execution logs
        - paracle pause # Pause running workflow
        - paracle resume # Resume paused workflow
        - paracle init --template # Initialize from template
        - paracle templates list # List available templates
        - paracle history compare # Compare execution versions

  - id: phase_9
    name: "Notifications & Advanced Features"
    duration: 2_weeks
    status: planned
    priority: low
    completion: 0%
    deliverables:
      - notification_system
      - multi_channel_alerts
      - time_travel_debugging
      - ab_testing
      - cost_tracking
    focus_areas:
      - "Multi-channel notifications (email, Slack, webhook)"
      - "Smart alerts (anomaly detection, cost thresholds)"
      - "Agent escalation on errors"
      - "Time travel debugging (replay executions)"
      - "A/B testing for agent configurations"
      - "Comprehensive cost tracking and reporting"
    cli_commands:
      planned:
        - paracle notify configure # Configure notification channels
        - paracle alerts list # List active alerts
        - paracle replay # Replay past execution
        - paracle compare # A/B test agent configs
        - paracle cost report # Generate cost report

  - id: phase_10
    name: "Polish & v0.1.0 Release"
    duration: 2_weeks
    status: planned
    priority: high
    deliverables:
      - comprehensive_docs
      - migration_guides
      - security_audit
      - performance_benchmarks
      - v0_1_0_release

# Persistence Implementation Details (Phase 4)
persistence_implementation:
  sqlite:
    package: "paracle_store"
    files:
      - "packages/paracle_store/database.py"
      - "packages/paracle_store/models.py"
      - "packages/paracle_store/sqlite_repository.py"
      - "packages/paracle_store/migrations/"
    tables:
      - agents: "Agent instances and status"
      - workflows: "Workflow definitions"
      - executions: "Workflow execution history"
      - events: "Event log"
      - audit: "Audit trail for ISO 42001"
      - sessions: "Work session data"

  configuration:
    file: "packages/paracle_core/storage.py"
    model: "StorageConfig"
    options:
      - workspace_path: "Path to .parac/ (default: .parac)"
      - database_url: "SQLite or PostgreSQL URL"
      - vector_store: "none | chroma | pgvector"

# Error Management Roadmap
error_management:
  current_state: "production_ready"
  rating: "8/10"

  # Implemented (Phase 0-4)
  implemented:
    - layer_specific_exceptions: "All packages have exceptions.py with error codes"
    - error_codes: "PARACLE-XXX-NNN format across all packages"
    - rfc_7807: "Problem Details in API responses"
    - exception_chaining: "Proper __cause__ usage"
    - structured_logging: "Correlation IDs, audit trail"
    - retry_logic: "RetryableProvider with exponential backoff"

# Dependencies
dependencies:
  phase_1: [phase_0]
  phase_2: [phase_1]
  phase_3: [phase_2]
  phase_4: [phase_3]
  phase_5: [phase_4]
  phase_6: [phase_5]
  phase_7: [phase_6]
  phase_8: [phase_5, phase_6] # Can run parallel with phase_7
  phase_9: [phase_8]
  phase_10: [phase_7, phase_9]

# Success Criteria
success_criteria:
  - functional_mvp
  - early_adopter_ready
  - stable_api
  - comprehensive_tests
  - production_ready_architecture
  - persistent_storage

# Link to Global Roadmap
global_roadmap:
  reference: ".roadmap/ROADMAP_GLOBALE.yaml"
  scope: "v0.0.1 - v0.2.0 (Phases 0-10)"
  community_edition: "Phases 0-10 (no UI/dashboard)"
  enterprise_edition: "Adds visual dashboard, team collaboration UI"
  future_phases: "v0.5.0 - v1.0.0 defined in global roadmap"

# Edition Differentiation
editions:
  community:
    description: "Full-featured CLI and API for programmatic control"
    includes:
      - "All core framework features"
      - "Execution safety and isolation"
      - "Iterative workflows and agent profiles"
      - "Git integration"
      - "Real-time monitoring (API/WebSocket)"
      - "Templates and quick-start"
      - "Notifications and alerts"
      - "Cost tracking and reporting"
    excludes:
      - "Web UI dashboard"
      - "Visual workflow builder"
      - "Kanban board interface"
      - "Graphical code review UI"
    target_users: "Developers, DevOps, CLI power users"

  enterprise:
    description: "Community + visual interfaces for team collaboration"
    additional_features:
      - "React-based web dashboard"
      - "Visual workflow builder (drag-and-drop)"
      - "Kanban board for workflow management"
      - "Graphical diff viewer"
      - "Team collaboration features"
      - "Role-based access control (RBAC)"
      - "Multi-tenant support"
    target_users: "Teams, enterprises, non-technical stakeholders"
    target_version: "v1.0.0+"
